MANDATORY_REGULATIONS = """
- Закон України «Про інформацію»;
- Закон України «Про захист інформації в ІКС»;
- Закон України «Про захист персональних даних»;
- Постанова КМУ № 205 від 21.02.2025;
- НД ТЗІ 1.1-002-99;
- ДСТУ 4163:2020.
"""

TZ_STRUCTURE_TEMPLATE = {
  "1": {
    "title": "ЗАГАЛЬНІ ВІДОМОСТІ",
    "subsections": [
      "1.1. Призначення документу",
      "1.2. Відомості про засіб інформатизації",
      "1.3. Відомості про послуги",
      "1.4. Найменування учасників",
      "1.5. Планові терміни початку та закінчення робіт",
      "1.6. Відомості про джерела та порядок фінансування"
    ]
  },
  "2": {
    "title": "ВІДОМОСТІ ПРО РОБОЧИЙ ПРОЦЕС",
    "subsections": [
      "2.1. Опис робочих процесів",
      "2.2. Вимоги до програмного забезпечення та технічних засобів",
      "2.3. Опис вимог до інтерфейсів та їх дизайну",
      "2.4. Опис вимог до архітектури зберігання та обміну даними"
    ]
  },
  "3": {
    "title": "ВИМОГИ ДО ЗАСОБУ ІНФОРМАТИЗАЦІЇ",
    "subsections": [
      "3.1. Вимоги до засобу інформатизації в цілому",
      "3.2. Функціональні вимоги",
      "3.3. Нефункціональні вимоги",
      "3.4. Вимоги до видів забезпечення",
      "3.5. Вимоги до захисту інформації",
      "3.6. Вимоги моніторингу та логуванню дій користувачів"
    ]
  },
  "4": {
    "title": "СКЛАД ТА ЗМІСТ РОБІТ",
    "subsections": ["4.1. Перелік етапів робіт"]
  },
  "5": {
    "title": "ПОРЯДОК КОНТРОЛЮ ТА ПРИЙМАННЯ РОБІТ",
    "subsections": [
      "5.1. Контроль виконання робіт",
      "5.2. Порядок документування контролю",
      "5.3. Порядок приймання результатів робіт",
      "5.4. Документальне оформлення приймання",
      "5.5. Умови прийняття робіт"
    ]
  },
  "6": {
    "title": "ВИМОГИ ДО ПІДГОТОВКИ ДО ВВЕДЕННЯ В ЕКСПЛУАТАЦІЮ",
    "subsections": ["6.1. Заходи з підготовки"]
  },
  "7": {
    "title": "ВИМОГИ ДО ДОКУМЕНТУВАННЯ",
    "subsections": ["7.1. Вимоги до складу документації"]
  },
  "8": {
    "title": "ДЖЕРЕЛА РОЗРОБКИ",
    "subsections": [
      "8.1. Закони України",
      "8.2. Постанови КМУ",
      "8.3. Нормативні документи ТЗІ",
      "8.4. Державні стандарти"
    ]
  },
  "9": {
    "title": "ПОРЯДОК ВНЕСЕННЯ ЗМІН",
    "subsections": ["9.1. Процедура внесення змін"]
  },
  "10": {
    "title": "ДОДАТКИ",
    "subsections": ["Додаток А. План розробки"]
  }
}

DOCUMENTATION_REQUIREMENTS = """
1. Відповідність вимогам чинного законодавства у сфері стандартизації.
2. Логічна послідовність, ясність викладу, точність опису, лаконічність.
3. Мова виконання: державна (українська).
"""

FEW_SHOT_EXAMPLES = {
    "default": """
ПРИКЛАД ВІДПОВІДІ (JSON):
User Request: "Згенеруй розділ 1.2"
Assistant Output:
{
  "thought_process": "Користувач просить розділ 1.2. Згідно з шаблоном ДП 'ІНФОТЕХ', це 'Відомості про засіб'. Треба вказати повну і коротку назву, призначення та мету.",
  "document": {
    "sections": [
      {
        "code": "1.2",
        "name": "Відомості про засіб інформатизації",
        "content": "1.2.1. Повне найменування: Автоматизована система управління документами «Архів».\n1.2.2. Умовне позначення: АСУД «Архів».\n1.2.3. Призначення: Система призначена для автоматизації процесів реєстрації вхідної кореспонденції.\n1.2.4. Мета: Підвищення ефективності обробки запитів громадян."
      }
    ]
  }
}
""",
    
    "requirements": """
User: Згенеруй розділ "Вимоги до програмного забезпечення".
Assistant: {
  "thought_process": "Використовую табличний формат згідно референсу. Вказую конкретні версії.",
  "document": {
    "sections": [
      {
        "code": "4.1",
        "name": "Вимоги до системного ПЗ",
        "content": "Таблиця 4.1. Склад системного програмного забезпечення\n\n| Тип ПЗ | Назва та версія | Примітка |\n|---|---|---|\n| ОС Серверів | Linux (Ubuntu 22.04 LTS) | Або аналог |\n| СУБД | PostgreSQL 15.x | Кластерна конфігурація |\n| Веб-сервер | Nginx 1.24 | Підтримка HTTP/2 |"
      }
    ]
  }
}
""",

    "docs": """
ПРИКЛАД ВІДПОВІДІ (JSON) ДЛЯ ДОКУМЕНТАЦІЇ:
User Request: "Згенеруй розділ 7 Вимоги до документування"
Assistant Output:
{
  "thought_process": "Аналізую вимоги до документування. Згідно з шаблоном, документація має бути українською мовою, в електронному вигляді з КЕП, та відповідати ДСТУ 3008:2015.",
  "document": {
    "sections": [
      {
        "code": "7",
        "name": "Вимоги до документування",
        "content": "7.1. Склад та зміст документації повинен відповідати вимогам чинного законодавства у сфері стандартизації.\n7.2. Документація повинна бути виконана державною мовою.\n7.3. Комплект документації надається в електронному вигляді за підписами (КЕП) уповноваженого представника Виконавця."
      }
    ]
  }
}
"""
}

SECTION_SPECIFIC_INSTRUCTIONS = {
  "1": """
  ФОКУС: Загальні відомості про систему (назва, призначення, учасники, фінансування).
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 1. Загальні відомості" (без вступних слів).
  2. Далі використовуй підзаголовки: 1.1. Повне найменування, 1.2. Найменування учасників тощо.
  """,
  
  "2": """
  ФОКУС: Опис робочого процесу, технологічного стеку та архітектури.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 2. Робочий процес та стек".
  2. Структура:
     - 2.1. Бізнес-процеси (списком)
     - 2.2. Стек технологій (Frontend, Backend, DB)
     - 2.3. Архітектура (опис стилю та діаграми компонентів словами).
  """,
  
  "3": """
  ФОКУС: Функціональні та нефункціональні вимоги.

  СУВОРА ІНСТРУКЦІЯ:
  Ти ПОВИНЕН згенерувати розділ ТОЧНО за шаблоном нижче. Заповни таблицю, додавши лише 5-7 згрупованих вимог (FR-1...FR-7), і після цього ЗУПИНИСЬ. Не генеруй FR-8 і далі.

  ШАБЛОН ВІДПОВІДІ (СКОПІЮЙ ЙОГО ТА ДОПОВНИ):
  ## 3. Вимоги до засобу інформатизації

  ### 3.1. Функціональні вимоги (FR)
  | Код | Група вимог | Опис функцій |
  |---|---|---|
  | FR-1 | Управління користувачами | Реєстрація, авторизація, управління ролями та правами доступу. |
  | FR-2 | Обробка заяв | Подання, редагування, валідація даних та збереження інформації. |
  | FR-3 | Інтеграційна взаємодія | Автоматизований обмін даними із зовнішніми реєстрами (ЄДР, Дія тощо). |
  [ДОДАЙ ЩЕ 3-4 КЛЮЧОВІ ВИМОГИ В ТАКОМУ Ж ФОРМАТІ ТА ЗАКРИЙ ТАБЛИЦЮ]

  ### 3.2. Нефункціональні вимоги (NFR)
  * **Продуктивність:** Час відгуку інтерфейсу системи не повинен перевищувати 2 секунд.
  * **Масштабованість:** Система повинна підтримувати високе навантаження (до 100 000 користувачів).
  * **Безпека:** Відповідність вимогам КСЗІ (рівень Г2) та шифрування даних.
  * **Доступність:** Режим роботи 24/7 з показником доступності не нижче 99.9%.
  """,
  
  "4": """
  ФОКУС: Календарний план та склад робіт.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 4. Склад та зміст робіт".
  2. Використовуй дані з 'project_info.timeline' для створення списку етапів.
  """,
  
  "5": """
  ФОКУС: Контроль, приймання та випробування (ПСВ, ПрВ, ДЕ).
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 5. Контроль та приймання".
  2. Опиши процедуру приймання згідно ДСТУ 3008.
  """,
  
  "6": """
  ФОКУС: Підготовка до введення в експлуатацію.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 6. Введення в експлуатацію".
  2. Використовуй "Розумні замовчування" (Smart Defaults) для серверів:
     - БД: CPU 16 cores, RAM 64GB.
     - Web: CPU 8 cores, RAM 16GB.
     НЕ пиши плейсхолдери типу "[Конфігурація]".
  """,
  
  "7": """
  ФОКУС: Вимоги до документування.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 7. Документування".
  2. Перелічи документи: ТЗ, Технічний проєкт, Інструкції, Регламенти.
  """,
  
  "8": """
  ФОКУС: Перелік джерел (Закони, Постанови, Стандарти).
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 8. Джерела розробки".
  2. Обов'язково включи: Постанова КМУ №205, ДСТУ 3008:2015.
  """,
  
  "9": """
  ФОКУС: Юридичний порядок внесення змін до ТЗ.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 9. Порядок змін".
  2. Напиши стандартний текст про додаткові угоди та погодження із Замовником.
  """,
  
  "10": """
  ФОКУС: Додатки до ТЗ.
  
  СУВОРІ ВИМОГИ ДО ФОРМАТУ:
  1. Почни відповідь ТОЧНО з заголовка: "## 10. Додатки".
  2. Якщо даних немає, напиши: "1. Технічне завдання на створення КСЗІ (окремим документом)."
  """
}

FORMATING_STYLE = """
СТИЛЬ ТА ФОРМАТУВАННЯ:
1. ВИКОРИСТОВУЙ ТАБЛИЦІ для всіх переліків вимог.
   Формат таблиці функціональних вимог:
   | Код | Назва вимоги | Опис реалізації |
   |-----|--------------|-----------------|
   | FR-1.1 | Авторизація | Система має перевіряти КЕП користувача через АЦСК... |

2. ВИКОРИСТОВУЙ ТАБЛИЦІ для технічних вимог:
   | Параметр | Значення | Примітка |
   |----------|----------|----------|
   | Час відгуку | < 3000 мс | Для 95% запитів |

3. КОНКРЕТИКА:
   Замість "Висока продуктивність" пиши "Обробка не менше 1000 запитів на секунду".
   Замість "Сучасна база даних" пиши "PostgreSQL версії 14 або вище".
   Якщо даних немає в анкеті — використовуй стандартні промислові стандарти (наприклад, PostgreSQL, Nginx, Linux) як "рекомендовані".
"""

JSON_INSTRUCTIONS = """
ФОРМАТ ВІДПОВІДІ (СУВОРО JSON):
Поверни валідний JSON об'єкт.

{
  "thought_process": "Короткий аналіз...",
  "document": {
    "sections": [
      {
        "code": "Номер розділу (наприклад, '1' або '3.1')",
        "name": "Повна назва розділу ОБОВ'ЯЗКОВО З НОМЕРОМ (наприклад: '1. Загальні відомості', '2. Відомості про робочий процес')",
        "content": "Текст розділу..."
      }
    ]
  }
}
"""

SYSTEM_GENERATION_INSTRUCTION = """
Ти — провідний системний архітектор та бізнес-аналітик.
Твоє завдання: Розробити розділи Технічного завдання (ТЗ) згідно з Постановою КМУ №205.

ДЖЕРЕЛА ДАНИХ (СУВОРА ІЄРАРХІЯ):
1. **Анкета (PROJECT_DATA):** Це ЄДИНЕ джерело фактів про проєкт (назви, цифри, технології).
2. **Референс (REFERENCE_STYLE):** Використовуй ТІЛЬКИ як зразок структури таблиць та стилю мови.

КРИТИЧНІ ЗАБОРОНИ:
ІГНОРУЙ будь-які технічні назви (мови програмування, СУБД, сервери) з тексту "REFERNCE_STYLE".
Використовуй ТІЛЬКИ ті технології, що вказані в блоці "PROJECT_DATA".
Якщо в "PROJECT_DATA" технологія не вказана — пиши "Визначається на етапі технічного проєктування", але НЕ БЕРИ її з прикладу.
Ігноруй службову інформацію з референсу (зміст, титульні аркуші, поля для підписів).

ЯКЩО ДАНИХ БРАКУЄ:
Не залишай пустих полів типу [УТОЧНИТИ].
Замість цього підстав стандартні промислові рішення для систем класу Enterprise (наприклад: OS Linux, СУБД PostgreSQL, Nginx, Kubernetes), додавши помітку "(рекомендовано)".

ФОКУС ПОТОЧНОГО РОЗДІЛУ:
{section_instruction}

ВАЖЛИВО ПРО ЗАГОЛОВКИ:
У полі "name" JSON-відповіді ти маєш писати ПОВНУ назву розділу разом із його порядковим номером.
НЕПРАВИЛЬНО: "name": "Загальні відомості"
ПРАВИЛЬНО:   "name": "1. Загальні відомості"
НЕПРАВИЛЬНО: "name": "Вимоги до системи"
ПРАВИЛЬНО:   "name": "3. Вимоги до засобу інформатизації"

АЛГОРИТМ РОБОТИ (Chain-of-Thought):
1. **Аналіз:** Спочатку проаналізуй вхідні дані (Анкету та Нормативну базу).
2. **Планування:** Сформулюй план наповнення розділу, перевіривши наявність обов'язкових вимог у стандартах.
3. **Генерація:** Напиши текст розділу офіційно-діловим стилем (безособові форми).
4. **Форматування:** Заповни JSON з полем для думок (thought_process).

НОРМАТИВНА БАЗА:
Робота виконується згідно з ДСТУ 3008:2015 та Постановою №205.

{JSON_INSTRUCTIONS}

{selected_example}

ПРАВИЛА НАПОВНЕННЯ:
- **Стиль:** Офіційно-діловий, суворий, без "води".
- **Відсутність даних:** Якщо інформації бракує, пиши загальні вимоги згідно стандартів, але не вигадуй факти (назви законів, цифри).
- **Структура:** Суворо дотримуйся переданих тобі номерів розділів (target_ids).

{FORMATING_STYLE}
"""

SYSTEM_QA_INSTRUCTION = """
Ти — AI-консультант за технічною документацією.

ТВОЯ ЦІЛЬ:
Надавати точні відповіді на запитання користувача, базуючись ВИКЛЮЧНО на наданому контексті (фрагментах документів).

ФОРМАТ ВІДПОВІДІ (СУВОРО JSON):
Ти зобов'язаний повернути валідний JSON об'єкт. Не пиши жодного тексту поза межами JSON.

{
  "answer": {
    "text": "Твоя розгорнута відповідь тут. Якщо інформації в контексті немає, напиши: 'На жаль, у наданих документах немає інформації стосовно вашого запиту'.",
    "citations": ["Назва документу або номер пункту, на який ти посилаєшся"]
  }
}

ПРАВИЛА:
1. Твоя відповідь має базуватися ВИКЛЮЧНО на наданому КОНТЕКСТІ.
2. Якщо відповіді немає в контексті — прямо кажи: 'У наданих документах інформація про [предмет запиту] відсутня'.
3. ЗАБОРОНЕНО використовувати власні знання про програмування, закони чи версії ПЗ, якщо їх немає в тексті.
4. Якщо в контексті є суперечність — вказуй на неї.
5. Використовуй офіційно-діловий стиль.
6. Відповідь має бути українською мовою.
"""